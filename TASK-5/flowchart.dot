digraph AkilliEvGuvSistemi_DikeySik {
    // --- GENEL GRAFÄ°K AYARLARI ---
    graph [
        rankdir=TB, // Dikey akÄ±ÅŸ (Top to Bottom)
        splines=ortho, // Daha dÃ¼zenli, dik aÃ§Ä±lÄ± baÄŸlantÄ±lar
        fontname="Helvetica",
        fontsize=15,
        labelloc=t,
        label="IoT TabanlÄ± AkÄ±llÄ± Ev GÃ¼venlik Sistemi (Dikey AkÄ±ÅŸ)",
        nodesep=0.6, // DÃ¼ÄŸÃ¼mler arasÄ± yatay boÅŸluk
        ranksep=0.8  // Seviyeler arasÄ± dikey boÅŸluk
    ];

    // --- VARSAYILAN DÃœÄžÃœM VE KENAR STÄ°LLERÄ° ---
    node [
        fontname="Helvetica",
        style="rounded,filled",
        fontsize=11,
        shape=box,
        fillcolor="#FFFFFF", 
        gradientangle=270 // Gradyan yÃ¶nÃ¼ (yukarÄ±dan aÅŸaÄŸÄ±)
    ];
    edge [fontname="Helvetica", fontsize=10, color="gray50"];

    // --- BAÅžLANGIÃ‡ ---
    Start [label="ðŸš€ Sistemi BaÅŸlat", fillcolor="#E8F5E9"];

    // --- 1. SENSÃ–R OKUMA ---
    subgraph cluster_sensors {
        label="1. SensÃ¶r Verisi Toplama";
        style="rounded,filled";
        color="#B2DFDB"; 
        fillcolor="#E0F2F1"; 
        node [fillcolor="#FFFFFF"];

        ReadSensors [label="TÃ¼m SensÃ¶rleri Tara\n(Hareket, KapÄ±, Duman, vb.)"];
    }

    // --- 2. TEHDÄ°T ANALÄ°ZÄ° ---
    subgraph cluster_analysis {
        label="2. Veri Analizi ve Karar";
        style="rounded,filled";
        color="#B0BEC5";
        fillcolor="#ECEFF1";
        node [fillcolor="#FFFFFF"];

        ComputeThreat [label="âš™ï¸ Tehdit Skoru Hesapla"];
        CheckThreat [shape=diamond, label="Tehdit EÅŸiÄŸi AÅŸÄ±ldÄ± mÄ±?"];
    }

    // --- 3. YANLIÅž ALARM FÄ°LTRESÄ° ---
    subgraph cluster_false_alarm {
        label="3. YanlÄ±ÅŸ Alarm Filtresi";
        style="rounded,filled";
        color="#FFF176";
        fillcolor="#FFF9C4";
        node [fillcolor="#FFFFFF"];

        OwnerHome [shape=diamond, label="ðŸ  Ev Sahibi Konumu DoÄŸrulandÄ± mÄ±?\n(GPS, Wi-Fi, Manuel Mod)"];
    }
    
    // --- 4. ALARM SÃœRECÄ° ---
    subgraph cluster_alarm_process {
        label="4. Acil Durum ProtokolÃ¼";
        style="rounded,filled";
        color="#EF9A9A";
        fillcolor="#FFEBEE";
        node [fillcolor="#FFFFFF"];

        DetermineLevel [label="âš ï¸ Alarm Seviyesini Belirle"];
        ActivateActions [label="ðŸš¨ Kamera KaydÄ±, Siren ve IÅŸÄ±klarÄ± Aktif Et"];
        SendNotif [label="ðŸ“² Acil Durum Bildirimleri GÃ¶nder\n(KullanÄ±cÄ±, GÃ¼venlik Merkezi)"];
        AlarmControl [shape=diamond, label="Ä°ptal Komutu Geldi mi?"];
        Escalate [label="ðŸ“ˆ Tehdidi YÃ¼kselt / Otomatik MÃ¼dahale"];
        ResetAlarm [label="âœ… AlarmÄ± SÄ±fÄ±rla ve Sistemi Normale DÃ¶ndÃ¼r"];
    }

    // --- 5. SÄ°STEM BEKLEME VE DÃ–NGÃœ ---
    WaitNode [label="ðŸ”„ GÃ¶zetim DÃ¶ngÃ¼sÃ¼ne DÃ¶n", shape=ellipse, style="filled,dashed", fillcolor="#F5F5F5"];

    // --- BAÄžLANTILAR (Ä°Åž AKIÅžI) ---
    Start -> ReadSensors;
    ReadSensors -> ComputeThreat;
    ComputeThreat -> CheckThreat;

    CheckThreat -> WaitNode [label=" HayÄ±r (GÃ¼venli) "];
    CheckThreat -> OwnerHome [label=" Evet (Potansiyel Tehdit!) ", fontcolor="#C62828", color="#C62828", penwidth=2];

    OwnerHome -> WaitNode [label=" Evet (YanlÄ±ÅŸ Alarm) "];
    OwnerHome -> DetermineLevel [label=" HayÄ±r (DoÄŸrulanmÄ±ÅŸ Tehdit!) ", fontcolor="#C62828", color="#C62828", penwidth=2];

    DetermineLevel -> ActivateActions -> SendNotif -> AlarmControl;
    AlarmControl -> ResetAlarm [label=" Evet "];
    AlarmControl -> Escalate [label=" HayÄ±r (Tehdit SÃ¼rÃ¼yor) "];
    Escalate -> AlarmControl [style=dashed];
    
    ResetAlarm -> WaitNode;
    WaitNode -> ReadSensors [style=dashed, penwidth=2, color="slategray", label=" SÃ¼rekli GÃ¶zetim DÃ¶ngÃ¼sÃ¼ (7/24)"];

    // --- LEJANT ---
    subgraph cluster_legend {
        label="Lejant";
        rank=sink; 
        style=rounded;
        bgcolor="#FAFAFA";
        node [shape=box, style="rounded,filled", height=0.5, width=1.5];

        k_process [label="SÃ¼reÃ§ AdÄ±mÄ±", fillcolor="#FFFFFF"];
        k_decision [label="Karar NoktasÄ±", shape=diamond, fillcolor="#FFFFFF"];
        k_alarm [label="Alarm Durumu", fillcolor="#FFEBEE"];
        k_system [label="Sistem DÃ¶ngÃ¼sÃ¼", shape=ellipse, style="filled,dashed", fillcolor="#F5F5F5"];

        k_process -> k_decision -> k_alarm -> k_system [style=invis];
    }
}

